
                            < M A T L A B (R) >
                  Copyright 1984-2017 The MathWorks, Inc.
                   R2017a (9.2.0.556344) 64-bit (glnxa64)
                               March 27, 2017

 
For online documentation, see http://www.mathworks.com/support
For product information, visit www.mathworks.com.
 
--------------------- BEGIN FILE main_effect.m-------------------
function main_effect(glmodel, regressor, contrast)

printcode;

EXPT = exploration_expt();

data = load_data;

filename = sprintf('main_effect_glm%d_%s_%s.mat', glmodel, regressor, replace(contrast, ' ', '_'));
disp(filename);


% get ROI masks
switch contrast
    case 'badre'
        % clusters = masks from paper
        masks = badre_2012_create_masks(false);
        %masks = masks(1); % TODO use all masks

    case 'tommy'
        % clusters = masks from paper
        masks = tommy_2017_create_masks(false);

    otherwise
        % group-level settings
        p = 0.001;
        alpha = 0.05;
        Dis = 20;
        Num = 1; % # peak voxels per cluster; default in bspmview is 3
        direct = '+';

        [V, Y, C, CI, region, extent, stat, mni, cor, results_table] = ccnl_extract_clusters(EXPT, glmodel, contrast, p, direct, alpha, Dis, Num);

        r = 10 / 1.5; % 10 mm radius

        % create spherical masks around peak voxel of each cluster (intersected with cluster)
        %
        for c = 1:length(region)
            masks{c} = sprintf('sphere_glm%d_%s_%d_%d_%d_r=%dmm.nii', glmodel, replace(contrast, ' ', '_'), mni(c,1), mni(c,2), mni(c,3), round(r * 1.5));
            cmask = CI == CI(cor(c,1), cor(c,2), cor(c,3));
            ccnl_create_spherical_mask(cor(c,1), cor(c,2), cor(c,3), r, masks{c}, cmask);
        end
        masknames = region';
end


clear stat;


for i = 1:length(masks)
    mask = masks{i};
    [~, masknames{i}, ~] = fileparts(mask);

    clear b;
    for s = 1:length(data)
        b(s) = mean(ccnl_get_beta(EXPT, glmodel, regressor, mask, s));
    end

    [h, p, ci, stats] = ttest(b);
    t = stats.tstat;
    ps(i,:) = p;
    m(i,:) = mean(b);
    disp(mask);
    p
    t
    b
    stat{i} = stats;
end

p_uncorr = ps;
p_corr = 1 - (1 - ps) .^ length(ps);

save(filename, '-v7.3');

table(masknames', p_uncorr, p_corr, m)

--------------------- END FILE main_effect.m-------------------
       datadir: '/ncf/gershman/Lab/Exploration/subjects/180725_UEP_001/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180727_UEP_002/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180727_UEP_003/preproc'
    structural: 'struct.nii'
    functional: {1×6 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180730_UEP_004/preproc'
    structural: 'struct.nii'
    functional: {1×6 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180730_UEP_005/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180801_UEP_006/preproc'
    structural: 'struct.nii'
    functional: {1×7 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180802_UEP_007/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180803_UEP_008/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180803_UEP_009/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180804_UEP010/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180804_UEP_011/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180804_UEP_012/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180804_UEP_013/preproc'
    structural: 'struct.nii'
    functional: {1×7 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180804_UEP_014/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180804_UEP_015/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180805_UEP_016/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180805_UEP_017/preproc'
    structural: 'struct.nii'
    functional: {1×7 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180805_UEP_018_2/preproc'
    structural: 'struct.nii'
    functional: {1×7 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180805_UEP_019/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180805_UEP_020/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180805_UEP_021/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180806_UEP_022/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180806_UEP_023/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180807_UEP_024/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180807_UEP_025/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180807_UEP_026/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180808_UEP_027/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180808_UEP_028/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180808_UEP_029/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180809_UEP_030/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

       datadir: '/ncf/gershman/Lab/Exploration/subjects/180809_UEP_031/preproc'
    structural: 'struct.nii'
    functional: {1×8 cell}

main_effect_glm21_TU_tommy.mat
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
masks/tommy_Insula_L_-30_16_-8_r=10mm.nii

p =

    0.0019


t =

    3.3957


b =

  Columns 1 through 7

    0.0661    0.1151   -0.1890    0.0784   -0.0357    0.0765   -0.0192

  Columns 8 through 14

    0.0934    0.1247   -0.0237   -0.0510    0.0809    0.0293    0.0736

  Columns 15 through 21

    0.0715    0.0221    0.1316    0.0219    0.0437    0.0902    0.0539

  Columns 22 through 28

    0.0157   -0.0013    0.0190    0.0634    0.0346    0.0806    0.0733

  Columns 29 through 31

   -0.0412    0.1028    0.0227

mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
masks/tommy_Insula_R_32_22_-8_r=10mm.nii

p =

    0.0180


t =

    2.5032


b =

  Columns 1 through 7

    0.0418    0.1000   -0.2014    0.0699   -0.0326    0.1057   -0.0024

  Columns 8 through 14

    0.0521    0.0865   -0.0103   -0.0490    0.0617    0.0222    0.0494

  Columns 15 through 21

   -0.0101    0.0267    0.1508    0.0224    0.0408    0.0737    0.0862

  Columns 22 through 28

    0.0019    0.0221    0.0068    0.0645    0.0460    0.0667    0.0782

  Columns 29 through 31

   -0.1030    0.1028   -0.0253

mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
masks/tommy_dACC_R_8_16_46_r=10mm.nii

p =

   4.1989e-06


t =

    5.6071


b =

  Columns 1 through 7

    0.1681    0.1561   -0.1507    0.0754    0.0081    0.1724    0.0297

  Columns 8 through 14

    0.0997    0.2145    0.0215   -0.0373    0.2086    0.0874    0.1043

  Columns 15 through 21

    0.0541    0.0794    0.2634    0.0155    0.0884    0.1114    0.1589

  Columns 22 through 28

    0.0185    0.0978    0.0755    0.1466    0.1087    0.0189    0.1145

  Columns 29 through 31

   -0.0648    0.1952    0.0834

mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
masks/Ca.nii

p =

    0.0120


t =

    2.6746


b =

  Columns 1 through 7

    0.0542    0.0267   -0.0100    0.0715    0.0076    0.0515   -0.0101

  Columns 8 through 14

    0.0619    0.0732   -0.0637   -0.0042    0.0303    0.0427   -0.0384

  Columns 15 through 21

   -0.0153   -0.0075    0.0790   -0.0126    0.0344    0.0123    0.0396

  Columns 22 through 28

    0.0027    0.0176   -0.0044    0.0029   -0.0101    0.0384    0.0379

  Columns 29 through 31

   -0.0581    0.0836    0.0317

mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
masks/Pu.nii

p =

    0.0296


t =

    2.2846


b =

  Columns 1 through 7

    0.0284    0.0857   -0.1246    0.0528   -0.0491    0.0671   -0.0173

  Columns 8 through 14

    0.0787    0.0785    0.0033   -0.0117    0.0177    0.0215    0.0296

  Columns 15 through 21

    0.0130    0.0187    0.0469   -0.0090    0.0397    0.0219    0.0520

  Columns 22 through 28

   -0.0026   -0.0389    0.0229    0.0465    0.0016    0.0619    0.0142

  Columns 29 through 31

   -0.0630    0.0485    0.0377

mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
mask
masks/NAC.nii

p =

    0.5256


t =

    0.6423


b =

  Columns 1 through 7

    0.0072    0.0757   -0.0896    0.0294   -0.0058    0.0002   -0.0495

  Columns 8 through 14

    0.0130    0.0881   -0.1094   -0.0266    0.0050    0.0489   -0.0006

  Columns 15 through 21

    0.0090    0.0036    0.0886    0.0471    0.0129    0.0048    0.0715

  Columns 22 through 28

   -0.0128   -0.0449   -0.0643   -0.0013   -0.0194    0.0503    0.0284

  Columns 29 through 31

   -0.0791    0.0730    0.0278


ans =

  6×4 table

                  Var1                    p_uncorr       p_corr          m    
    _________________________________    __________    __________    _________

    'tommy_Insula_L_-30_16_-8_r=10mm'     0.0019453      0.011615     0.039485
    'tommy_Insula_R_32_22_-8_r=10mm'       0.017981       0.10315     0.030475
    'tommy_dACC_R_8_16_46_r=10mm'        4.1989e-06    2.5193e-05      0.08785
    'Ca'                                   0.011994      0.069838     0.018228
    'Pu'                                   0.029582       0.16487     0.018473
    'NAC'                                   0.52556       0.98859    0.0058431

